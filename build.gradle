plugins {
    id "com.eriwen.gradle.js" version "2.14.1"
    id "com.eriwen.gradle.css" version "2.14.0"
    id 'com.craigburke.client-dependencies' version '1.3.1'

}

clientDependencies {
    installDir = "${buildDir}/node_modules"
    cacheDir = "${buildDir}/client-cache/"
    useGlobalCache = true
    checkDownloads = true
    npm {
        'lodash'('4.16.6') {
            include '**/*.js'
        }
    }
}

minifyJs {
    source = ["${projectDir}/lib", "${projectDir}/src/javascript", clientDependencies.installDir]
    source.each{ logger.warn ("$it") }
    dest = file("${buildDir}/app.js")
    sourceMap = file("${buildDir}/app.sourcemap.json")
    closure {
        warningLevel = 'QUIET'
        compilerOptions.languageIn="ECMASCRIPT6"
        compilerOptions.languageOut="ECMASCRIPT5"
        compilerOptions.processCommonJSModules = true
        compilationLevel = "ADVANCED_OPTIMIZATIONS"
    }
}
minifyJs.dependsOn clientInstall

lesscss {
    source = "${projectDir}/src/less"
    dest = "${buildDir}/css"
}

combineCss {
    source = lesscss.dest
    dest = file("${buildDir}/app-combined.css")
}
combineCss.dependsOn lesscss

minifyCss {
    source = combineCss.dest
    dest = file("${buildDir}/app.css")
}
minifyCss.dependsOn combineCss

task(together) << {
    println "Ready to go :)"
}
together.dependsOn minifyJs
together.dependsOn minifyCss


/*
combineJs {
    source = ["${projectDir}/src/javascript"]
    // show the resolved files when gradle is run with -d
    source.each{ logger.debug ("$it") }
    dest = file("${buildDir}/all.js")
}
*/

/*
gzipJs {
    source = minifyJs.dest
    dest = file("${buildDir}/app.min.js.gz")
}
gzipJs.dependsOn minifyJs
*/

